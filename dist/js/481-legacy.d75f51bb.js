"use strict";(self["webpackChunkSMGS"]=self["webpackChunkSMGS"]||[]).push([[481],{95684:function(e,t,o){o.d(t,{Z:function(){return g}});o(74916),o(77601);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-box"},[e._m(0),t("transition",{attrs:{name:"plus-icon"}},[e.pageOneShow?[t("div",{staticClass:"login-form"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},["sso"===e.styleData.login_type?t("div",{staticClass:"login-other"},e._l(e.allObj.loginWays,(function(o){return t("button",{key:o.SyName,staticClass:"workwechat-login"},[t("a",{staticClass:"workwechat",attrs:{title:o.WayName,href:o.WayToUrl}},[t("p",{staticClass:"login-font"},[t("img",{staticClass:"workwechat-img",attrs:{src:o.WayImgUrl,alt:""}}),e._v(" "+e._s(e._f("capitalize")(o.WayName))+" ")])])])})),0):t("div",[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,model:e.ruleFormData}},[t("el-form-item",{staticClass:"form-items",attrs:{prop:e.EMAIL_REGEX.test(e.ruleFormData.username)?"userEmail":e.MOBILENUM_REGEX.test(e.ruleFormData.username)?"username":"otheruser"}},[t("el-input",{attrs:{clearable:"",placeholder:"Please enter your email"},model:{value:e.ruleFormData.username,callback:function(t){e.$set(e.ruleFormData,"username",t)},expression:"ruleFormData.username"}})],1),t("el-form-item",{staticClass:"form-items",attrs:{prop:"password"}},[t("el-input",{attrs:{placeholder:"Enter password","show-password":"",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitFormToken("ruleForm")}},model:{value:e.ruleFormData.password,callback:function(t){e.$set(e.ruleFormData,"password",t)},expression:"ruleFormData.password"}})],1),e.isAdmin?t("el-form-item",[t("div",{attrs:{id:"text_login"}},[t("div",{staticClass:"forget-password",on:{click:e.toForgetPage}},[t("span",[e._v("Forgot Password?")])])])]):e._e(),t("el-form-item",{staticClass:"form-items"},[t("div",{staticClass:"box-form-out"},[t("div",{staticClass:"box-form-out-in-box"},[t("div",{staticClass:"box-form-out-inner"},[t("el-button",{staticClass:"btn",on:{click:function(t){return e.submitFormToken("ruleForm")}}},[t("span",[e._v("LOGIN")])]),t("div",{staticClass:"forget-pwd"})],1)])])])],1),t("el-dialog",{attrs:{title:"Swipe And Verify",visible:e.dialogVisible,width:e.dialogWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("DragVerify",{key:e.mainKey,attrs:{message:{isPass:e.isPass,dialogVisible:e.dialogVisible,isFailed:e.isFailed}},on:{sendMessage:e.sendMessage,sendFiledMessage:e.sendFiledMessage}})],1)],1)]),e.isAdmin?t("div",{staticClass:"bottom-text-signup"},[t("div",[t("p",[e._v("Don’t have an account? "),t("span",{on:{click:e.toSignUp}},[e._v("Sign Up")])])])]):e._e()],1)]:e.pageTwoShow?[t("div",[t("el-form",{ref:"ruleFormCode",attrs:{rules:e.rulesCode,model:e.CodeFormData}},[t("div",{staticStyle:{"margin-bottom":"-20px"}},[t("span",{staticStyle:{"font-weight":"600","font-size":"16px"}},[e._v("2FA Code")])]),t("el-form-item",{staticClass:"form-items",staticStyle:{"margin-top":"40px"},attrs:{prop:"code"}},[t("el-input",{attrs:{placeholder:e.$t("message.spCodemsg"),clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitCode("ruleFormCode")}},model:{value:e.CodeFormData.code,callback:function(t){e.$set(e.CodeFormData,"code",t)},expression:"CodeFormData.code"}})],1),t("div",{staticStyle:{"margin-top":"20px","margin-bottom":"10px"}},[t("span",{staticStyle:{color:"grey","line-height":"18px"}},[e._v(e._s(e.$t("message.codeDes")))])]),t("el-form-item",{staticClass:"form-items"},[t("div",{staticClass:"box-form-out"},[t("div",{staticClass:"box-form-out-in-box"},[t("div",{staticClass:"box-form-out-inner"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.needBind,expression:"needBind"}],staticClass:"spbtn backbtn",on:{click:e.backQrCode}},[e._v("Back")]),t("el-button",{staticClass:"spbtn registeringbtn",on:{click:function(t){return e.submitCode("ruleFormCode")}}},[t("span",[e._v(e._s(e.$t("message.ok")))])]),t("div",{staticClass:"forget-pwd"})],1)])])])],1)],1)]:[t("div",{staticStyle:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center"}},[t("div",[t("img",{attrs:{src:e.QRCodeUrl,alt:"",width:"240"}})]),t("div",[t("p",{staticClass:"tips"},[e._v(" Please use "),t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en&pli=1",target:"_blank"}},[e._v("Google Authenticator App")]),e._v(" or "),t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.azure.authenticator&hl=en_US",target:"_blank"}},[e._v("Microsoft Authenticator App")]),e._v(" Scan QR code ")]),t("div",{staticClass:"stepbtn"},[t("el-button",{staticClass:"registeringbtn",attrs:{type:"primary"},on:{click:e.nextPage}},[e._v("Next")])],1)])])]],2)],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-box-top-area"},[t("div",{staticClass:"login-title"},[t("span",[e._v("Scholarship Management Gateway System")])]),t("div",{staticClass:"login-top-text"},[t("span",[e._v("Log In")])])])}],r=o(51907),i=o(85617),n=(o(57658),o(38862),o(28762)),l=o(1950),u=o(16777),c=o(68028),d={filters:{capitalize:function(e){return e+this.$t("message.login")}},props:{allObj:Object,logo_path:String,styleData:Object,isAdmin:Boolean},components:{DragVerify:l.Z},data:function(){return{needBind:!1,dialogWidth:"",dialogVisible:!1,isPass:!1,isFailed:!1,timer:null,timer2:null,timer3:null,ruleFormData:{username:"",password:""},EMAIL_REGEX:/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,MOBILENUM_REGEX:/^\d{4,11}$/,pubKey:"",EMAILS:"",userid:"",loading:!0,pageOneShow:null,pageTwoShow:null,QRCodeUrl:"",CodeFormData:{code:""},userIdsq:"",exToken:"",resultUri:""}},computed:{rules:function(){return{username:[{pattern:/^\d{4,11}$/,message:this.$t("message.msgIphone"),trigger:["blur","change"]}],userEmail:[{pattern:/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,message:this.$t("message.msgEmail"),trigger:["blur","change"]}],otheruser:[{required:!0,message:this.$t("message.msgOther"),trigger:["blur","change"]}],password:[{required:!0,message:this.$t("message.msgpassword"),trigger:["blur","change"]}]}},rulesCode:function(){return{code:[{pattern:/^\d{6}$/,message:this.$t("message.spCodemsg"),trigger:["blur","change"]}]}}},methods:{sendFiledMessage:function(e){console.log(e,"pp")},sendMessage:function(e){var t=this;return(0,i.Z)((0,r.Z)().mark((function o(){var s;return(0,r.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:s=e.isPass,t.isPass=s,setTimeout((0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.dialogVisible=!1,t.allObj.userData.useQingFlowVersion<=4.5?t.loginBefore():t.loginAfter();case 2:case"end":return e.stop()}}),e)}))),200);case 3:case"end":return o.stop()}}),o)})))()},cancelSubmitForm:function(){this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1},handleClose:function(){this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1},nextPage:function(){this.pageOneShow=!1,this.pageTwoShow=!0},backQrCode:function(){this.pageOneShow=!1,this.pageTwoShow=!1},toForgetPage:function(){this.$router.push("/repassword")},toSignUp:function(){this.$router.push("/register")},resetForm:function(e){this.$refs[e].resetFields()},getPubKey:function(){var e=this;return(0,i.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.Pd)().then((function(t){var o=t.data.code;console.log(t,"herer"),0===o?e.pubKey=t.data.data.pubkey:e.$notify.error({title:"error",message:"errorCode:".concat(o),duration:0,position:"bottom-left",showClose:!0})}));case 2:case"end":return t.stop()}}),t)})))()},submitFormToken:function(e){var t=this;this.$refs[e].validate((function(e){e&&(t.isPass?t.dialogVisible=!1:t.dialogVisible=!0)}))},toCodeOther:function(){this.pageOneShow=!1,this.pageTwoShow=!0},submitCode:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var o=t.CodeFormData.code,s={userId:t.userIdsq,checkCode:o};t.checkAuthentication(s)}}))},checkTwoFA:function(){var e=this;return(0,i.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.rB)(JSON.stringify({userId:e.userIdsq})).then((function(t){if(0===t.data.code){console.log(t.data.result);var o=t.data.result,s=o.need2FA,a=o.needBind,r=o.qrCode,i=o.uri;e.needBind=a,e.resultUri=i,s?a?(e.pageOneShow=!1,e.pageTwoShow=!1,e.QRCodeUrl=r):(e.pageOneShow=!1,e.pageTwoShow=!0):(document.cookie=e.styleData.qflowType+"QflowToken="+e.exToken+";path=/;domain=."+e.styleData.qflowDomain,setTimeout((function(){window.location.href=i}),2e3))}else e.$notify.error({title:"error",message:"Message：".concat(t.data.message),duration:0,position:"bottom-left",showClose:!0}),e.resetForm("ruleForm")}),(function(t){e.$notify.error({title:"erros",message:"error status:".concat(t.response.status),duration:0,position:"bottom-left",showClose:!0})}));case 2:case"end":return t.stop()}}),t)})))()},checkAuthentication:function(e){var t=this;return(0,i.Z)((0,r.Z)().mark((function o(){return(0,r.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,(0,c.Oj)(JSON.stringify(e)).then(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(o){return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:0===o.data.code?(document.cookie=t.styleData.qflowType+"QflowToken="+t.exToken+";path=/;domain=."+t.styleData.qflowDomain,t.$notify.success({title:"success",message:"2FA verification succeeded",duration:0,position:"bottom-left",showClose:!0}),setTimeout((function(){window.location.href=t.resultUri}),2200)):(t.$notify.error({title:"error",message:"Message:".concat(o.data.message),duration:0,position:"bottom-left",showClose:!0}),t.resetForm("ruleForm"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){t.$notify.error({title:"error",message:"error status:".concat(e.response.status),duration:0,position:"bottom-left",showClose:!0})}));case 2:case"end":return o.stop()}}),o)})))()},loginBefore:function(){var e=this;return(0,i.Z)((0,r.Z)().mark((function t(){var o,s,a;return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=new n.Z,o.setPublicKey(e.pubKey),s=o.encrypt(e.ruleFormData.password),a=null,e.EMAIL_REGEX.test(e.ruleFormData.username)?a={email:e.ruleFormData.username,areaCode:"86",mobile:"",password:s}:e.MOBILENUM_REGEX.test(e.ruleFormData.username)&&(a={email:"",areaCode:"86",mobile:e.ruleFormData.username,password:s}),t.next=7,(0,c.$5)(JSON.stringify(a)).then((function(t){if(void 0!=t.data.token){var o=t.data,s=o.token,a=o.userInfo.lastWsInfo.exUserId;e.userIdsq=a,e.exToken=s,e.checkTwoFA(a)}else"41110"==t.data.statusCode?(e.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),e.resetForm("ruleForm"),e.dialogVisibleTips=!1,e.isPass=!1,e.mainKey=e.mainKey+1):(e.$notify.error({title:"error",message:"errorCode:".concat(t.data.statusCode),duration:0,position:"bottom-left",showClose:!0}),e.resetForm("ruleForm"))}),(function(t){e.$notify.error({title:"error",message:"errorCode:".concat(t.response.status),duration:0,position:"bottom-left",showClose:!0})}));case 7:case"end":return t.stop()}}),t)})))()},loginAfter:function(){var e=this;return(0,i.Z)((0,r.Z)().mark((function t(){var o,s,a;return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=new n.Z,o.setPublicKey(e.pubKey),console.log(e.pubKey),s=o.encrypt(e.ruleFormData.password),a=null,e.EMAIL_REGEX.test(e.ruleFormData.username)?a={email:e.ruleFormData.username,areaCode:"86",mobile:"",password:s,loginType:"email"}:e.MOBILENUM_REGEX.test(e.ruleFormData.username)&&(a={email:"",areaCode:"86",mobile:e.ruleFormData.username,password:s,loginType:"phone"}),t.next=8,(0,c.dw)(JSON.stringify(a)).then((function(t){if(200===t.status&&0===t.data.code){var o=t.data.data[0];console.log(o)}else"41110"==t.data.statusCode?(e.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),e.resetForm("ruleForm"),e.dialogVisibleTips=!1,e.isPass=!1,e.mainKey=e.mainKey+1):(e.$notify.error({title:"error",message:"errorCode:".concat(t.data.statusCode),duration:0,position:"bottom-left",showClose:!0}),e.resetForm("ruleForm"))}),(function(t){e.$notify.error({title:"error",message:"errorCode:".concat(t.response.status),duration:0,position:"bottom-left",showClose:!0})}));case 8:case"end":return t.stop()}}),t)})))()},getToken:function(e){var t=this;return(0,i.Z)((0,r.Z)().mark((function o(){return(0,r.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,(0,c.CE)(JSON.stringify(e)).then((function(e){if(200===e.status&&0===e.data.code){if(void 0!=e.data.data.token){var o=e.data.token;document.cookie=t.styleData.qflowType+"QflowToken="+o+";path=/;domain=."+t.styleData.qflowDomain,window.location.href=t.styleData.homeUrl,console.log("token")}}else"41110"==e.data.statusCode?(t.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),t.resetForm("ruleForm"),t.dialogVisibleTips=!1,t.isPass=!1,t.mainKey=t.mainKey+1):(t.$notify.error({title:"error",message:"errorCode:".concat(e.data.statusCode),duration:0,position:"bottom-left",showClose:!0}),t.resetForm("ruleForm"))}),(function(e){t.$notify.error({title:"error",message:"errorCode:".concat(e.response.status),duration:0,position:"bottom-left",showClose:!0})}));case 2:case"end":return o.stop()}}),o)})))()}},created:function(){(0,u.tq)()?this.dialogWidth="100%":this.dialogWidth="30%"},mounted:function(){this.getPubKey(),this.pageOneShow=!0,this.pageTwoShow=!1}},m=d,p=o(43736),f=(0,p.Z)(m,s,a,!1,null,"64d07ad8",null),g=f.exports}}]);
//# sourceMappingURL=481-legacy.d75f51bb.js.map