"use strict";(self["webpackChunkSMGS"]=self["webpackChunkSMGS"]||[]).push([[481],{5684:function(e,t,s){s.d(t,{Z:function(){return c}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-box"},[e._m(0),t("transition",{attrs:{name:"plus-icon"}},[e.pageOneShow?[t("div",{staticClass:"login-form"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},["sso"===e.styleData.login_type?t("div",{staticClass:"login-other"},e._l(e.allObj.loginWays,(function(s){return t("button",{key:s.SyName,staticClass:"workwechat-login"},[t("a",{staticClass:"workwechat",attrs:{title:s.WayName,href:s.WayToUrl}},[t("p",{staticClass:"login-font"},[t("img",{staticClass:"workwechat-img",attrs:{src:s.WayImgUrl,alt:""}}),e._v(" "+e._s(e._f("capitalize")(s.WayName))+" ")])])])})),0):t("div",[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,model:e.ruleFormData}},[t("el-form-item",{staticClass:"form-items",attrs:{prop:e.EMAIL_REGEX.test(e.ruleFormData.username)?"userEmail":e.MOBILENUM_REGEX.test(e.ruleFormData.username)?"username":"otheruser"}},[t("el-input",{attrs:{clearable:"",placeholder:"Please enter your email"},model:{value:e.ruleFormData.username,callback:function(t){e.$set(e.ruleFormData,"username",t)},expression:"ruleFormData.username"}})],1),t("el-form-item",{staticClass:"form-items",attrs:{prop:"password"}},[t("el-input",{attrs:{placeholder:"Enter password","show-password":"",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitFormToken("ruleForm")}},model:{value:e.ruleFormData.password,callback:function(t){e.$set(e.ruleFormData,"password",t)},expression:"ruleFormData.password"}})],1),e.isAdmin?t("el-form-item",[t("div",{attrs:{id:"text_login"}},[t("div",{staticClass:"forget-password",on:{click:e.toForgetPage}},[t("span",[e._v("Forgot Password?")])])])]):e._e(),t("el-form-item",{staticClass:"form-items"},[t("div",{staticClass:"box-form-out"},[t("div",{staticClass:"box-form-out-in-box"},[t("div",{staticClass:"box-form-out-inner"},[t("el-button",{staticClass:"btn",on:{click:function(t){return e.submitFormToken("ruleForm")}}},[t("span",[e._v("LOGIN")])]),t("div",{staticClass:"forget-pwd"})],1)])])])],1),t("el-dialog",{attrs:{title:"Swipe And Verify",visible:e.dialogVisible,width:e.dialogWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("DragVerify",{key:e.mainKey,attrs:{message:{isPass:e.isPass,dialogVisible:e.dialogVisible,isFailed:e.isFailed}},on:{sendMessage:e.sendMessage,sendFiledMessage:e.sendFiledMessage}})],1)],1)]),e.isAdmin?t("div",{staticClass:"bottom-text-signup"},[t("div",[t("p",[e._v("Don’t have an account? "),t("span",{on:{click:e.toSignUp}},[e._v("Sign Up")])])])]):e._e()],1)]:e.pageTwoShow?[t("div",[t("el-form",{ref:"ruleFormCode",attrs:{rules:e.rulesCode,model:e.CodeFormData}},[t("div",{staticStyle:{"margin-bottom":"-20px"}},[t("span",{staticStyle:{"font-weight":"600","font-size":"16px"}},[e._v("2FA Code")])]),t("el-form-item",{staticClass:"form-items",staticStyle:{"margin-top":"40px"},attrs:{prop:"code"}},[t("el-input",{attrs:{placeholder:e.$t("message.spCodemsg"),clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitCode("ruleFormCode")}},model:{value:e.CodeFormData.code,callback:function(t){e.$set(e.CodeFormData,"code",t)},expression:"CodeFormData.code"}})],1),t("div",{staticStyle:{"margin-top":"20px","margin-bottom":"10px"}},[t("span",{staticStyle:{color:"grey","line-height":"18px"}},[e._v(e._s(e.$t("message.codeDes")))])]),t("el-form-item",{staticClass:"form-items"},[t("div",{staticClass:"box-form-out"},[t("div",{staticClass:"box-form-out-in-box"},[t("div",{staticClass:"box-form-out-inner"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.needBind,expression:"needBind"}],staticClass:"spbtn backbtn",on:{click:e.backQrCode}},[e._v("Back")]),t("el-button",{staticClass:"spbtn registeringbtn",on:{click:function(t){return e.submitCode("ruleFormCode")}}},[t("span",[e._v(e._s(e.$t("message.ok")))])]),t("div",{staticClass:"forget-pwd"})],1)])])])],1)],1)]:[t("div",{staticStyle:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center"}},[t("div",[t("img",{attrs:{src:e.QRCodeUrl,alt:"",width:"240"}})]),t("div",[t("p",{staticClass:"tips"},[e._v(" Please use "),t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en&pli=1",target:"_blank"}},[e._v("Google Authenticator App")]),e._v(" or "),t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.azure.authenticator&hl=en_US",target:"_blank"}},[e._v("Microsoft Authenticator App")]),e._v(" Scan QR code ")]),t("div",{staticClass:"stepbtn"},[t("el-button",{staticClass:"registeringbtn",attrs:{type:"primary"},on:{click:e.nextPage}},[e._v("Next")])],1)])])]],2)],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-box-top-area"},[t("div",{staticClass:"login-title"},[t("span",[e._v("Scholarship Management Gateway System")])]),t("div",{staticClass:"login-top-text"},[t("span",[e._v("Log In")])])])}],i=(s(7658),s(8762)),r=s(1950),l=s(6777),n=s(8028),d={filters:{capitalize:function(e){return e+this.$t("message.login")}},props:{allObj:Object,logo_path:String,styleData:Object,isAdmin:Boolean},components:{DragVerify:r.Z},data(){return{needBind:!1,dialogWidth:"",dialogVisible:!1,isPass:!1,isFailed:!1,timer:null,timer2:null,timer3:null,ruleFormData:{username:"",password:""},EMAIL_REGEX:/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,MOBILENUM_REGEX:/^\d{4,11}$/,pubKey:"",EMAILS:"",userid:"",loading:!0,pageOneShow:null,pageTwoShow:null,QRCodeUrl:"",CodeFormData:{code:""},userIdsq:"",exToken:"",resultUri:""}},computed:{rules(){return{username:[{pattern:/^\d{4,11}$/,message:this.$t("message.msgIphone"),trigger:["blur","change"]}],userEmail:[{pattern:/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,message:this.$t("message.msgEmail"),trigger:["blur","change"]}],otheruser:[{required:!0,message:this.$t("message.msgOther"),trigger:["blur","change"]}],password:[{required:!0,message:this.$t("message.msgpassword"),trigger:["blur","change"]}]}},rulesCode(){return{code:[{pattern:/^\d{6}$/,message:this.$t("message.spCodemsg"),trigger:["blur","change"]}]}}},methods:{sendFiledMessage(e){console.log(e,"pp")},async sendMessage(e){const{isPass:t}=e;this.isPass=t,setTimeout((async()=>{this.dialogVisible=!1,this.allObj.userData.useQingFlowVersion<=4.5?this.loginBefore():this.loginAfter()}),200)},cancelSubmitForm(){this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1},handleClose(){this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1},nextPage(){this.pageOneShow=!1,this.pageTwoShow=!0},backQrCode(){this.pageOneShow=!1,this.pageTwoShow=!1},toForgetPage(){this.$router.push("/repassword")},toSignUp(){this.$router.push("/register")},resetForm(e){this.$refs[e].resetFields()},async getPubKey(){await(0,n.Pd)().then((e=>{const{code:t}=e.data;console.log(e,"herer"),0===t?this.pubKey=e.data.data.pubkey:this.$notify.error({title:"error",message:`errorCode:${t}`,duration:0,position:"bottom-left",showClose:!0})}))},submitFormToken(e){this.$refs[e].validate((e=>{e&&(this.isPass?this.dialogVisible=!1:this.dialogVisible=!0)}))},toCodeOther(){this.pageOneShow=!1,this.pageTwoShow=!0},submitCode(e){this.$refs[e].validate((e=>{if(e){const{code:e}=this.CodeFormData,t={userId:this.userIdsq,checkCode:e};this.checkAuthentication(t)}}))},async checkTwoFA(){await(0,n.rB)(JSON.stringify({userId:this.userIdsq})).then((e=>{if(0===e.data.code){console.log(e.data.result);const{need2FA:t,needBind:s,qrCode:o,uri:a}=e.data.result;this.needBind=s,this.resultUri=a,t?s?(this.pageOneShow=!1,this.pageTwoShow=!1,this.QRCodeUrl=o):(this.pageOneShow=!1,this.pageTwoShow=!0):(document.cookie=this.styleData.qflowType+"QflowToken="+this.exToken+";path=/;domain=."+this.styleData.qflowDomain,setTimeout((()=>{window.location.href=a}),2e3))}else this.$notify.error({title:"error",message:`Message：${e.data.message}`,duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm")}),(e=>{this.$notify.error({title:"erros",message:`error status:${e.response.status}`,duration:0,position:"bottom-left",showClose:!0})}))},async checkAuthentication(e){await(0,n.Oj)(JSON.stringify(e)).then((async e=>{0===e.data.code?(document.cookie=this.styleData.qflowType+"QflowToken="+this.exToken+";path=/;domain=."+this.styleData.qflowDomain,this.$notify.success({title:"success",message:"2FA verification succeeded",duration:0,position:"bottom-left",showClose:!0}),setTimeout((()=>{window.location.href=this.resultUri}),2200)):(this.$notify.error({title:"error",message:`Message:${e.data.message}`,duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"))}),(e=>{this.$notify.error({title:"error",message:`error status:${e.response.status}`,duration:0,position:"bottom-left",showClose:!0})}))},async loginBefore(){let e=new i.Z;e.setPublicKey(this.pubKey);let t=e.encrypt(this.ruleFormData.password),s=null;this.EMAIL_REGEX.test(this.ruleFormData.username)?s={email:this.ruleFormData.username,areaCode:"86",mobile:"",password:t}:this.MOBILENUM_REGEX.test(this.ruleFormData.username)&&(s={email:"",areaCode:"86",mobile:this.ruleFormData.username,password:t}),await(0,n.$5)(JSON.stringify(s)).then((e=>{if(void 0!=e.data.token){const{token:t,userInfo:{lastWsInfo:{exUserId:s}}}=e.data;this.userIdsq=s,this.exToken=t,this.checkTwoFA(s)}else"41110"==e.data.statusCode?(this.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"),this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1):(this.$notify.error({title:"error",message:`errorCode:${e.data.statusCode}`,duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"))}),(e=>{this.$notify.error({title:"error",message:`errorCode:${e.response.status}`,duration:0,position:"bottom-left",showClose:!0})}))},async loginAfter(){let e=new i.Z;e.setPublicKey(this.pubKey),console.log(this.pubKey);let t=e.encrypt(this.ruleFormData.password),s=null;this.EMAIL_REGEX.test(this.ruleFormData.username)?s={email:this.ruleFormData.username,areaCode:"86",mobile:"",password:t,loginType:"email"}:this.MOBILENUM_REGEX.test(this.ruleFormData.username)&&(s={email:"",areaCode:"86",mobile:this.ruleFormData.username,password:t,loginType:"phone"}),await(0,n.dw)(JSON.stringify(s)).then((e=>{if(200===e.status&&0===e.data.code){let t=e.data.data[0];console.log(t)}else"41110"==e.data.statusCode?(this.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"),this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1):(this.$notify.error({title:"error",message:`errorCode:${e.data.statusCode}`,duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"))}),(e=>{this.$notify.error({title:"error",message:`errorCode:${e.response.status}`,duration:0,position:"bottom-left",showClose:!0})}))},async getToken(e){await(0,n.CE)(JSON.stringify(e)).then((e=>{if(200===e.status&&0===e.data.code){if(void 0!=e.data.data.token){var t=e.data.token;document.cookie=this.styleData.qflowType+"QflowToken="+t+";path=/;domain=."+this.styleData.qflowDomain,window.location.href=this.styleData.homeUrl,console.log("token")}}else"41110"==e.data.statusCode?(this.$notify.error({title:"error",message:"You have entered an invalid username or password. Please try again.",duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"),this.dialogVisibleTips=!1,this.isPass=!1,this.mainKey=this.mainKey+1):(this.$notify.error({title:"error",message:`errorCode:${e.data.statusCode}`,duration:0,position:"bottom-left",showClose:!0}),this.resetForm("ruleForm"))}),(e=>{this.$notify.error({title:"error",message:`errorCode:${e.response.status}`,duration:0,position:"bottom-left",showClose:!0})}))}},created(){(0,l.tq)()?this.dialogWidth="100%":this.dialogWidth="30%"},mounted(){this.getPubKey(),this.pageOneShow=!0,this.pageTwoShow=!1}},m=d,u=s(3736),h=(0,u.Z)(m,o,a,!1,null,"64d07ad8",null),c=h.exports}}]);
//# sourceMappingURL=481.003d65aa.js.map